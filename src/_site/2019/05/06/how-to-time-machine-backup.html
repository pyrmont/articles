<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>How-To: Back Up a Sleeping MacBook’s Time Machine to an External Disk | articles.inqk.net</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="How-To: Back Up a Sleeping MacBook’s Time Machine to an External Disk" />
<meta name="author" content="Michael Camilleri" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Instructions on how to save a sleeping MacBook’s Time Machine backups to an external disk." />
<meta property="og:description" content="Instructions on how to save a sleeping MacBook’s Time Machine backups to an external disk." />
<link rel="canonical" href="http://localhost:4000/2019/05/06/how-to-time-machine-backup.html" />
<meta property="og:url" content="http://localhost:4000/2019/05/06/how-to-time-machine-backup.html" />
<meta property="og:site_name" content="articles.inqk.net" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-06T10:35:42+09:00" />
<script type="application/ld+json">
{"dateModified":"2019-05-07T10:28:47+09:00","datePublished":"2019-05-06T10:35:42+09:00","headline":"How-To: Back Up a Sleeping MacBook’s Time Machine to an External Disk","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/05/06/how-to-time-machine-backup.html"},"author":{"@type":"Person","name":"Michael Camilleri"},"description":"Instructions on how to save a sleeping MacBook’s Time Machine backups to an external disk.","url":"http://localhost:4000/2019/05/06/how-to-time-machine-backup.html","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=2daa2b27c8b7174fdff1f614d852c8ece5845587">
    <link rel="stylesheet" href="/assets/css/barefoot.min.css?v=2daa2b27c8b7174fdff1f614d852c8ece5845587">
    <link rel="alternate" type="application/atom+xml" href="/feed.xml" />

    <link rel="shortcut icon" href="/assets/icons/favicon.ico?v=2daa2b27c8b7174fdff1f614d852c8ece5845587" />
    <link rel="icon" type="image/png" href="/assets/icons/favicon-196.png?v=2daa2b27c8b7174fdff1f614d852c8ece5845587" sizes="196x196">
    <link rel="apple-touch-icon image_src" href="/assets/icons/apple-touch-icon.png?v=2daa2b27c8b7174fdff1f614d852c8ece5845587">

    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="post">
        <a href="http://localhost:4000"> <h1>&#10042; articles.inqk.net</h1> </a>
        <p>Usually more extended thoughts by <a href="https://inqk.net/">Michael Camilleri</a>.
</p>
        <p class="instructions">Read <a href="/instructions.html">how</a> to use this blog.</p>
      </header>

<section class="post">
  <div class="tldr">
    <div class="heading">TLDR</div>
    <p>Instructions on how to save a sleeping MacBook’s Time Machine backups to an external disk.</p>

  </div>

  <article>
    <h1>How‑To: Back Up a Sleeping MacBook’s Time Machine to an External Disk
</h1>

    <div class="metadata">
      <time datetime="2019-05-06 10:35:42 +0900">6 May 2019</time>
      <span class="history"><a href="https://github.com/pyrmont/articles/commits/master/_posts/2019-05-06-how-to-time-machine-backup.md">Revision History</a></span>
    </div>

    <p>This article will only be relevant if you meet the following criteria:</p>
<ul>
<li>you have a MacBook;</li>
<li>you plug in an external disk only when charging;</li>
<li>you want to save Time Machine backups to the external disk;</li>
<li>you have your Mac set up to accept <code>ssh</code> connections;</li>
<li>you have another computer with <code>ssh</code> and <code>cron</code>.</li>
</ul>
<p>If you match that description, or if you just like reading technical guides, enjoy!</p>
<h2>Steps</h2>
<h3>Step 1. Back Up to Your Disk</h3>
<p>The remaining steps expect a disk that’s been set up for Time Machine. Open Time Machine, connect your disk and make your first backup. If you choose to protect your backup with a password, note that down.</p>
<h3>Step 2. Find Your Disk ID</h3>
<p>Our automation strategy takes advantage of the fact that you can initiate a Time Machine backup from the command line but for that we need to know the unique identifier for your disk.</p>
<p>While your disk is still connected, open Terminal and type the following:</p>
<pre class="code highlight language-sh"><code><span class="line-1">diskutil list</span>
</code></pre>
<p>Make a note of the long identifier for your external disk. It will look something like <code>12345678-1234-1234-1234-12345678ABCD</code>.</p>
<h3>Step 3. Create the Shell Script</h3>
<p>Save this script somewhere on your Mac:</p>
<pre class="code highlight language-txt"><code><span class="line-1">#!/bin/bash</span>
<span class="line-2"></span>
<span class="line-3">echo "Unlocking disk..."</span>
<span class="line-4">diskutil coreStorage unlockVolume &lt;disk_id&gt; -passphrase "&lt;passphrase&gt;"</span>
<span class="line-5"></span>
<span class="line-6">echo "Mounting disk..."</span>
<span class="line-7">diskutil mount &lt;disk_id&gt; </span>
<span class="line-8"></span>
<span class="line-9">echo "Backing up disk..."</span>
<span class="line-10">tmutil startbackup --auto --block</span>
<span class="line-11"></span>
<span class="line-12">echo "Ejecting disk..."</span>
<span class="line-13">diskutil eject &lt;disk_id&gt;</span>
</code></pre>
<p>You can omit the passphrase option to the first <code>diskutil</code> command if you chose not to use a password.</p>
<p>We’re now finished with the steps we’ll do on the Mac.</p>
<h3>Step 4. Power Your External Disk</h3>
<p>If you put your MacBook to sleep by closing the lid and plugging in a power cable, you’ll find that macOS will not be able to mount a subsequently plugged in external disk if that disk is not separately powered in some way.</p>
<p>This doesn’t mean you necessarily need an externally powered disk. I’m using a bus-powered USB disk but have it connected via a separately powered hub (which ensures the disk has power without needing to draw it from the Mac).</p>
<h3>Step 5. Create the <code>cron</code> Job</h3>
<p>Now move to the second computer. I use a Raspberry Pi but you can use any computer as long as it has <code>ssh</code> and <code>cron</code>.</p>
<p>Type the following at a command line:</p>
<pre class="code highlight language-sh"><code><span class="line-1">crontab <span class="nt">-e</span></span>
</code></pre>
<p>Add the following line to the end of your crontab file:</p>
<pre class="code highlight language-txt"><code><span class="line-1">0 5 * * * ssh &lt;hostname_of_your_mac&gt;.local "/bin/sh &lt;path_to_script&gt;"</span>
</code></pre>
<p>The <code>0 5 * * *</code> means the backup will start at 5 am everyday. You can choose a different time and frequency by following the <a href="https://www.adminschoice.com/crontab-quick-reference">instructions here</a>.</p>
<p>If you’re using SSH keys, you need a slightly different command:<span class="connector">&#65279;<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></span></p>
<pre class="code highlight language-txt"><code><span class="line-1">0 5 * * * . ~/.keychain/&lt;keychain_file&gt; &amp;&amp; ssh &lt;hostname_of_your_mac&gt;.local "/bin/sh &lt;path_to_script&gt;"</span>
</code></pre>
<p>That’s it, you’re done!</p>
<h2>Rationale</h2>
<p>Some of you may be wondering, why would you want to do this when macOS can back up over a network connection? There are two reasons.</p>
<ul>
<li>First, while macOS does support using a network drive for Time Machine backups, <a href="https://www.macworld.com/article/3170844/when-backups-go-bad-the-problem-with-using-network-drives-with-time-machine.html">they are flaky as shit</a>.</li>
</ul>
<ul>
<li>Second, should you ever want to restore from the backup, you don’t want to be doing this over a network connection.</li>
</ul>
<p>By using an external disk, you avoid these problems. It’s not ideal and it would be preferable if Time Machine worked properly with network drives but this is unfortunately not one of the situations where ‘it just works’.&nbsp;&#10042;</p>
<section class="footnotes">
<ol>
<li id="fn1">
<p>This assumes you’re using a system running <a href="https://www.funtoo.org/Keychain"><code>keychain</code></a>. <a href="#fnref1" class="footnote-backref">↩</a></p>
</li>
</ol>
</section>


  </article>
</section>

      <footer class="post">
        <p><small>This post was written by <a href="https://inqk.net/">Michael Camilleri</a>, a person on the Internet. If you have any comments, please reach out on <a href="https://micro.blog/pyrmont/">Micro.blog</a> or  <a href="https://twitter.com/pyrmont/">Twitter</a>. Original work placed in the public domain. All rights are disclaimed. <a href="/licence.html">Why?</a></small></p>
      </footer>
    </div>

    <script src="/assets/js/barefoot.min.js?v=2daa2b27c8b7174fdff1f614d852c8ece5845587"></script>
    <script>
      lf = new BareFoot();
      lf.init();
    </script>

  </body>
</html>

